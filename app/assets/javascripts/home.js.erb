"use strict";

$(document).ready(function(){

    navigator.geolocation.getCurrentPosition(positionSuccess, positionError);

    // Gets the user's location

    function positionSuccess(position){
      var latitude = position.coords.latitude;
      var longitude = position.coords.longitude;

        var response = "http://bustime.mta.info/api/where/stops-for-location.json?lat=" + latitude + "&lon=" + longitude + "&latSpan=0.003&lonSpan=0.003&key=<%= ENV['MTA_API_KEY'] %>" ;
        // debugger;
      function nearestStops(){
        // debugger;
        // var response = "http://bustime.mta.info/api/where/stops-for-location.json?lat=40.708727599999996&lon=-74.002798&latSpan=0.005&lonSpan=0.005&key=<%= ENV['MTA_API_KEY'] %>" ;

        $.ajax({
          type: "GET",
          dataType: "jsonp",
          url: response,
          data: {},
          success: function(result){    
            var stopObjects = $(result)[0].data.stops ;
            
              
            [].forEach.call(stopObjects, function(stopObjects){
                
                var stopName = stopObjects.name.toLowerCase();
              $('#stops').append(
                "Bus Stop Location: " + stopName + '<br>'
            );
              
          });

          }
        });
        

      }
      nearestStops();
    }

    function positionError(error){
      console.warn('ERROR: ' + error.code + ': ' + error.message);
    }

});